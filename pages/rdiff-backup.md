---
title: "Rdiff-backup"
layout: page
tags: computer
---

Лирика на тему
===================================

Когда я последний раз делала бэкап? Если это было недавно, и за прошедшее время ничего интересного и стоящего сохранения на компе не появилось, то прекрасно. Если нет, сделай. Прямо сейчас. Как можно скорее.

Совет не новый, как и большинство похожих советов. И ценность его понимаешь только тогда, когда что-то случается.

Пока что я бэкаплюсь нерегулярно, но бэкаплюсь. И всё ещё помню шок, который пережила, думая, что вся собранная мной инфа по интересовавшей меня теме - погибла, когда попортился диск в нетбуке. Боюсь, что этот шок был причиной моего остывания к теме - я не стала пытаться собрать всё заново, просто печалилась. И тогда, наверное, от волнения и ещё от плохой организации системы, я не нашла сделанную раньше копию. Нашла совсем недавно. И быстро сделала ещё одну.

Мелочь, но действительно сильные и неприятные переживания, которых мне хотелось бы избежать. Поэтому я стараюсь бэкапиться чаще. Чтобы просто быть уверенной в наличии исправной копии всего.

7 марта 2016. Разгребаю старые бэкапы. Очень понимаю, почему мне не хотелось делать новые. Потому что множить бардак, \*ругательные слова\*. Потому что у меня эта тема не продумана как следует... И если я тут сделаю приемлемо, это будет плюс много спокойствия и уверенности.

8 марта 2016. Продолжаю думать бэкапы. Как ни странно, сложная задача - определить, что, собственно, у меня ценного и достойного сохранения, и как это отделить от неценного )

10 марта 2016 В порядке подготовки всего, что стоит сохранять, к сохранению, сделала очередной заход на упорядочение почты. Теперь почта вся лежит в одной папке, вся индексируется, одинаковые файлы удалены... и теперь я знаю, что у меня на нынешний момент 66 918 сообщений (это тех, которые считаются разными, не дублей), и занимает это счастье 8,5 гигабайт. Ну, понятно, что почта за несколько лет, что не только переписка с людьми, но и рассылки, а то и спам. И понятно, что не так страшны письма, как аттачи к ним. Но ничего так, ничего себе...

16 марта 2016. Потихоньку бэкаплюсь. rdiff-backup, пока пинаю вручную. Разбираюсь с тем, что нужно, что не очень. Разгребаю какие-то давние-давние залежи. Смотрю, что происходит, когда бэкапимая папка меняется. И вообще, как оно всё. Потихоньку думаю, как сделать бэкапление по возможности автоматическим, когда всё немного устаканится. Понятно же, что разгребать - только вручную, решать только самой, это никому доверить нельзя. А вот уже решённое-разобранное-опробованное можно и компу поручить. И да, правда, наличие “правдоподобного” бэкапа очень успокаивает. Даже частичного. Потому что за что-то уже спокойнее. За почту. За библиотеку и прочие подборки разновсякого. За какие-то свои текстики. За сохранность паролей. И надо будет намыслить, куда делать ещё одну копию. Потому что одной мало для спокойствия.

# Создание бэкапов {#subsec:comp-rdiff-create}


    rdiff-backup /source/path /destination/path

В результате в `/destination/path` будет создано зеркало каталога `/source/path`. Если мы внесем какие-либо изменения в `/source/path`, а потом выполним команду бекапа повторно, утилита определит, что именно изменилась и добавить копию только изменившихся файлов, а может даже только изменившуюся часть этих файлов, хотя фиг знает. В любом случае появится новый слепок каталога. Посмотреть наличие слепков можно командой:

     rdiff-backup -l /destination/path

Утилита делает инкремент только в том случае, если были внесены какие-то изменения в файлы и каталоги со времени последнего выполнения бекапа. Благодаря этому мы получаем:

- Возможность экономить дисковое пространство. Если я не ошибаюсь, инкременты делаются до тех пор, пока их суммарный объем не превысит половины объема от последнего полного бекапа. Когда это случается, делается снова полный бекап

- Возможность вернуться не просто к последнему бекапу, а бекапу за определенное число

Чтобы получить краткую сводку после выполненного бекапа, достаточно в команду внести опцию `--print-statistic`

     rdiff-backup --print-statistic /source/path /destination/path

# Восстановление данных

Что бы восстановить данные, необходимо выполнить команду вида:

     rdiff-backup -r now /destination/path /local/path

В результате мы восстановим данные из последнего выполненного бекапа в каталог `/local/path.`

Поскольку в `/destination/path` хранится полное дерево того, что мы бекапим, то можно указать для восстановления только определенный файл или каталог, например так:

     rdiff-backup -r now /destination/path/some/directory/or/file /local/path

Что бы восстановить файлы 5 дневной давности, можно воспользоваться такой командой:

     rdiff-backup -r 5D /destination/path/some/directory/or/file /local/path

Можно восстановить и по определенной дате:

     rdiff-backup -r 2012-08-05 /destination/path/some/directory/or/file /local/path

В этом случае нужно сначала просмотреть список доступных инкрементов, после чего указать TIMESTAMP того, что Вам нужен:

     rdiff-backup -r 2012-08-13T21:51:03+06:00 /destination/path/some/directory/or/file /local/path

# Удаляем старое {#subsec:comp-rdiff-old}

Естественно, что хранить кучу устаревшего файла нет смысла. Rdiff-backup умеет и прибирать за собой. Давайте удалим бекапы старше, чем 16 недель:

    rdiff-backup --remove-older-than 16W /destination/path

Если в тот день имеется только инкремент полного бекапа, то останутся все предыдущие до момента создания этого инкремента бекапы, вплоть до предыдущего полного бекапа. Таким образом удаление старых бекапов не приведет к неработоспособности оставшихся инкрементов.
